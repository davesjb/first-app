import*as t from"@popperjs/core";import e from"./base-component.js";import i from"./dom/event-handler.js";import s from"./dom/manipulator.js";import{defineJQueryPlugin as n,execute as o,findShadowRoot as r,getElement as l,getUID as a,isRTL as h,noop as c}from"./util/index.js";import{DefaultAllowlist as p}from"./util/sanitizer.js";import m from"./util/template-factory.js";let NAME="tooltip",DISALLOWED_ATTRIBUTES=new Set(["sanitize","allowList","sanitizeFn"]),CLASS_NAME_FADE="fade",CLASS_NAME_MODAL="modal",CLASS_NAME_SHOW="show",SELECTOR_TOOLTIP_INNER=".tooltip-inner",SELECTOR_MODAL=".modal",EVENT_MODAL_HIDE="hide.bs.modal",TRIGGER_HOVER="hover",TRIGGER_FOCUS="focus",TRIGGER_CLICK="click",TRIGGER_MANUAL="manual",EVENT_HIDE="hide",EVENT_HIDDEN="hidden",EVENT_SHOW="show",EVENT_SHOWN="shown",EVENT_INSERTED="inserted",EVENT_CLICK="click",EVENT_FOCUSIN="focusin",EVENT_FOCUSOUT="focusout",EVENT_MOUSEENTER="mouseenter",EVENT_MOUSELEAVE="mouseleave",AttachmentMap={AUTO:"auto",TOP:"top",RIGHT:h()?"left":"right",BOTTOM:"bottom",LEFT:h()?"right":"left"},Default={allowList:p,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},DefaultType={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Tooltip extends e{constructor(e,i){if(void 0===t)throw TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,i),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Default}static get DefaultType(){return DefaultType}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),i.off(this._element.closest(SELECTOR_MODAL),EVENT_MODAL_HIDE,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;let t=i.trigger(this._element,this.constructor.eventName("show")),e=r(this._element),s=(e||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!s)return;this._disposePopper();let n=this._getTipElement();this._element.setAttribute("aria-describedby",n.getAttribute("id"));let{container:o}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(o.append(n),i.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(n),n.classList.add(CLASS_NAME_SHOW),"ontouchstart"in document.documentElement)for(let l of[].concat(...document.body.children))i.on(l,"mouseover",c);let a=()=>{i.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1};this._queueCallback(a,this.tip,this._isAnimated())}hide(){if(!this._isShown())return;let t=i.trigger(this._element,this.constructor.eventName("hide"));if(t.defaultPrevented)return;let e=this._getTipElement();if(e.classList.remove(CLASS_NAME_SHOW),"ontouchstart"in document.documentElement)for(let s of[].concat(...document.body.children))i.off(s,"mouseover",c);this._activeTrigger.click=!1,this._activeTrigger[TRIGGER_FOCUS]=!1,this._activeTrigger[TRIGGER_HOVER]=!1,this._isHovered=null;let n=()=>{!this._isWithActiveTrigger()&&(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),i.trigger(this._element,this.constructor.eventName("hidden")))};this._queueCallback(n,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){let e=this._getTemplateFactory(t).toHtml();if(!e)return null;e.classList.remove(CLASS_NAME_FADE,CLASS_NAME_SHOW),e.classList.add(`bs-${this.constructor.NAME}-auto`);let i=a(this.constructor.NAME).toString();return e.setAttribute("id",i),this._isAnimated()&&e.classList.add(CLASS_NAME_FADE),e}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new m({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(CLASS_NAME_FADE)}_isShown(){return this.tip&&this.tip.classList.contains(CLASS_NAME_SHOW)}_createPopper(e){let i=o(this._config.placement,[this,e,this._element]),s=AttachmentMap[i.toUpperCase()];return t.createPopper(this._element,e,this._getPopperConfig(s))}_getOffset(){let{offset:t}=this._config;return"string"==typeof t?t.split(",").map(t=>Number.parseInt(t,10)):"function"==typeof t?e=>t(e,this._element):t}_resolvePossibleFunction(t){return o(t,[this._element])}_getPopperConfig(t){let e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:t=>{this._getTipElement().setAttribute("data-popper-placement",t.state.placement)}}]};return{...e,...o(this._config.popperConfig,[e])}}_setListeners(){let t=this._config.trigger.split(" ");for(let e of t)if("click"===e)i.on(this._element,this.constructor.eventName("click"),this._config.selector,t=>{let e=this._initializeOnDelegatedTarget(t);e.toggle()});else if("manual"!==e){let s=e===TRIGGER_HOVER?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),n=e===TRIGGER_HOVER?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");i.on(this._element,s,this._config.selector,t=>{let e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusin"===t.type?TRIGGER_FOCUS:TRIGGER_HOVER]=!0,e._enter()}),i.on(this._element,n,this._config.selector,t=>{let e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusout"===t.type?TRIGGER_FOCUS:TRIGGER_HOVER]=e._element.contains(t.relatedTarget),e._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},i.on(this._element.closest(SELECTOR_MODAL),EVENT_MODAL_HIDE,this._hideModalHandler)}_fixTitle(){let t=this._element.getAttribute("title");t&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){!this._isWithActiveTrigger()&&(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(t,e){clearTimeout(this._timeout),this._timeout=setTimeout(t,e)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){let e=s.getDataAttributes(this._element);for(let i of Object.keys(e))DISALLOWED_ATTRIBUTES.has(i)&&delete e[i];return t={...e,..."object"==typeof t&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=!1===t.container?document.body:l(t.container),"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.title&&(t.title=t.title.toString()),"number"==typeof t.content&&(t.content=t.content.toString()),t}_getDelegateConfig(){let t={};for(let[e,i]of Object.entries(this._config))this.constructor.Default[e]!==i&&(t[e]=i);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each(function(){let e=Tooltip.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw TypeError(`No method named "${t}"`);e[t]()}})}}n(Tooltip);export default Tooltip;